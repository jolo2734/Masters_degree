# Masters_degree
For my Master's degree: "Analiza podatności i automatyzacja bezpieczeństwa w klastrach Kubernetes"/"Vulnerability analysis and security automation in Kubernetes clusters". Mainly to save all yaml files for Kubernetes deployments. Maybe for IaaC.

Everything apart from deploying VMS will be automated by ansible or by bash scripts or in kustomisation.yaml file.

### Description:
- Part 1. Plan is to deploy Kubernetes cluster and set a lot of security mechanisms described below.
- Part 2. Compare Kubernetes security features/capabilities with DockerSwarm(I know, not very ambicious:) ) security features/capabilities.

(In my master work I won't take into account the security settings of deployed application inside the cluster, only setting of cluster(networking, access, privileges, ...) and host(access from pods to host layer) etc.)
## Tasks
- [x] deploy 4 hosts for k8s cluster
- [x] deploy k8s cluster
- [x] deploy application and generate traffic
- [x] configure network policy(done for elasticsearch)
- [x] configure Pod Security Admission(done for default namespace)
- [x] configure RBAC(only example)
- [x] scan k8s cluster(CIS standard - kube-bench, vulnerabilities - kube-hunter)
- [x] secure cluster hosts
- [x] prepare threat monitoring based on Falco
- [x] prepare auto-defense mechanisms based on Falco detection
- [x] compare security of k8s with Docker Swarm

### Deploy hosts
For k8s cluster there will be 4 VMs with [Ubuntu 20.04.04 LTS](https://ubuntu.com/download/desktop/thank-you?version=22.04.4&architecture=amd64) created on VirtualBox:
- 1 master
  - mgr-k8s-master-01(2 vCPU, 8GB RAM)
- 3 workers
  - mgr-k8s-worker-01(2 vCPU, 8GB RAM)
  - mgr-k8s-worker-02(2 vCPU, 8GB RAM)
  - mgr-k8s-worker-03(2 vCPU, 8GB RAM)

For monitoring and managing purposes will be deployed separate, not hardened, VM:
- manage-and-monitor(1 vCPU, 8GB RAM)

Hosts configuration:
- [X] set nat network
- [X] ssh configs for ansible
- [x] set guest configurations
- [X] set static ip
- [x] add 100GB drive per worker

After each task VMs will be snapshoted to preserve working configuration states, also will ba backed up on another disc.
### Deploy Kubernetes 1.28.6
This version of Kubernetes is chosen due to compatibility with Kubespray.
Kubernetes will be deployed by [Kubespray v2.24.1](https://github.com/kubernetes-sigs/kubespray/tree/v2.24.1).

### Hosts security
 - hardening - Hardening of Ubuntu 20.04.4 LTS is done in compliance with CIS standards. It is done by Ubuntu Pro plugin which check and set proper configuration of host.
Additional hardening need to be done regarding access from pods to host machine.
 - data encryption - by LUKS
 - transmission encryption by mTLS
 - backups - Elasticsearch mechanism and dumpall of PostgreSQL

### Deploy some applications
 - Flask
 - ElasticSearch
 - PostgreSQL

### Security Policy
 - Network Policies
 - Pod Security Admission
 - RBAC
 - mTLS by Istio

### Deploy threat monitoring
 - Falco

### Attacks
For Falco
 - generated by Falco Event-generator
 - ncat command
 - unknown binary drop and executed on container

For Other mechanism
 - ?

### Auto-defense mechanisms
 Falco -> Falco Sidekick ->:
 - send alerts to Discord
 - delete attacked Pod by ArgoEvents and ArgoWorkflow

### Protection from webattacks
ModSecurity in MGINX Ingress Controller

## TODO
### Cluster hardening
Hardening of Kubernetes cluster is done in compliance with CIS standards, which are ensured during creating cluster by Kubespray [with this additional options](https://github.com/kubernetes-sigs/kubespray/blob/v2.24.1/docs/hardening.md).
